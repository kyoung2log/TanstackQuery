### Query Cancellation

- 탄스택 쿼리는 각 쿼리 함수에 AbortSignal이라는 인스턴스를 제공한다.
  쿼리 오래됐거나, 비활성화 되었을 때 이 시그널이 중단된다. 이는 원하는 경우 쿼리 함수 내에서 취소 할 수 있다는 의미. 이 방식의 가장 좋은점은 async/await 문법을 사용하면서 자동 취소의 장점을 취할 수 있다는 것이다.

- AbortController API는 런타임 환경에서 이용가능하지만 브라우저에 따라 폴리필 해야할 수도 있음

- Default behavior

  - 기본적으로, Promise가 resolved 되기 전에 쿼리가 언마운트 되거나, 사용되지 않게 된 쿼리는 취소 못함. -> 즉 Promise가 resolves 된 후에도 결과 데이터는 캐싱된다는 의미이다.
  - 이는 쿼리를 받기 시작했는데, 쿼리가 끝나기도 전에 컴포넌트를 언마운트한 경우에 유용하다. 만약 내가 컴포너틑 다시 마운트 하고 쿼리가 가비지 컬렌션에서 지워지지 않았다면 데이터는 이용가능하다.
  - 하지만 abortSignal를 사용하면 프로미스가 취소되며, 쿼리도 취소된다. 쿼리를 취소하면 이전 상태값이 된다.

- 수동으로 취소하기
  - 만약 요청완료까지 시간이 너무 오래 걸릴 때, 사용자가 버튼을 눌러 요청을 취소해야할 경우가 있을 수 있다. 그 때 queryClient.cancelQueries({ queryKey })를 사용하면 취소된다.
- 하지만 Suspense 관련 훅에서는 지원안함요

- 결론!
  - 탄스택 쿼리는 각 쿼리함수안에서 기본적으로 AbortSignal이라는 인스턴스를 제공한다. 이 인스턴스는 쿼리가 언마운트 되거나, 새로고침/무효화 등의 상태가 되면 자동으로 중단 신호를 쏴줌 AbortSignal.abort() 이렇게!
  - 그래서 쿼리함수의 파라미터로 signal을 받으면 저 신호를 감지해서 자동으로 쿼리를 취소해 준다는 의미이다.
  - 원래는 언마운트 되어도 백그라운드에서 요청이 마무리 되고 캐싱되지만, AbortSignal을 통해 자동으로 멈출 수 있다는 것을 의미
  - 사용 예시
    - 유저가 화면을 빠르게 돌려서 이전 요청이 필요 없어 졌을 경우
    - 검색창에서 인풋에 따라 요청이 나갈 때
